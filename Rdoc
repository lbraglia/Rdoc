#!/usr/bin/Rscript --vanilla --quiet

args <- commandArgs(trailingOnly = TRUE)

usage <- function(){cat('
Usage:

   Rdoc string              - Use help
   Rdoc package::string     - Use help
   Rdoc -hs string          - Use help.search
   Rdoc -a string           - Use apropos
   Rdoc -v [string]         - Use vignette
   Rdoc -s string           - Use sos::findFn

')
}

Rdoc_quit <- function(){
    usage()
    quit(save = 'no', status = 1)
}

if(0L == length(args)){
    Rdoc_quit()
}

## --------
## Helpers
## --------


Help <- function(args){
    if (length(args) > 1)
        Rdoc_quit()
    splitted <- strsplit(args, '::')[[1]]
    if (length(splitted) == 1L){
        help_topic <- splitted
        help_package <- NULL
    } else if (length(splitted) == 2L) {
        help_package <- splitted[1]
        help_topic <- splitted[2]
    } else {
        Rdoc_quit()
    }
    help(topic =   (help_topic),   # see ?help on why (), searching pkg_ref
         package = (help_package), # see ?help on why (), searching pkg_ref
         lib.loc = NULL,
         verbose = FALSE,
         try.all.packages = getOption('help.try.all.packages'),
         help_type = getOption('help_type', 'text'))
}


## -----
## Main
## -----

if ('-hs' == args[1]) {
    Help.search(args[-1])
} else if ('-a' == args[1]){
    Apropos(args[-1])
} else if ('-v' == args[1]){
    Vignette(args[-1])
} else if ('-s' == args[1]){
    SOS(args[-1])
} else {
    Help(args)
}
